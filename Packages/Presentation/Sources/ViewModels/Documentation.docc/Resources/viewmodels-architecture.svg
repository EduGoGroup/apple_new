<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 500" width="800" height="500">
  <defs>
    <style>
      .box { fill: #f5f5f5; stroke: #333; stroke-width: 2; rx: 8; }
      .box-view { fill: #e3f2fd; stroke: #1976d2; }
      .box-vm { fill: #fff3e0; stroke: #f57c00; }
      .box-cqrs { fill: #e8f5e9; stroke: #388e3c; }
      .box-domain { fill: #fce4ec; stroke: #c2185b; }
      .box-event { fill: #f3e5f5; stroke: #7b1fa2; }
      .text { font-family: -apple-system, BlinkMacSystemFont, sans-serif; font-size: 14px; fill: #333; }
      .text-title { font-weight: bold; font-size: 16px; }
      .text-small { font-size: 12px; fill: #666; }
      .arrow { fill: none; stroke: #666; stroke-width: 2; marker-end: url(#arrowhead); }
      .arrow-event { stroke: #7b1fa2; stroke-dasharray: 5,5; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#666"/>
    </marker>
    <marker id="arrowhead-purple" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#7b1fa2"/>
    </marker>
  </defs>

  <!-- Title -->
  <text x="400" y="30" text-anchor="middle" class="text text-title" font-size="20">ViewModels Architecture - EduGo</text>

  <!-- SwiftUI View Layer -->
  <rect x="50" y="60" width="150" height="80" class="box box-view"/>
  <text x="125" y="90" text-anchor="middle" class="text text-title">SwiftUI View</text>
  <text x="125" y="110" text-anchor="middle" class="text text-small">@State viewModel</text>
  <text x="125" y="125" text-anchor="middle" class="text text-small">Observes changes</text>

  <!-- ViewModel Layer -->
  <rect x="280" y="60" width="200" height="100" class="box box-vm"/>
  <text x="380" y="90" text-anchor="middle" class="text text-title">ViewModel</text>
  <text x="380" y="110" text-anchor="middle" class="text text-small">@MainActor @Observable</text>
  <text x="380" y="130" text-anchor="middle" class="text text-small">isLoading, error, data</text>
  <text x="380" y="150" text-anchor="middle" class="text text-small">Mediator + EventBus</text>

  <!-- Mediator -->
  <rect x="550" y="60" width="180" height="80" class="box box-cqrs"/>
  <text x="640" y="90" text-anchor="middle" class="text text-title">CQRS Mediator</text>
  <text x="640" y="110" text-anchor="middle" class="text text-small">send(Query)</text>
  <text x="640" y="125" text-anchor="middle" class="text text-small">execute(Command)</text>

  <!-- Handlers -->
  <rect x="550" y="180" width="180" height="70" class="box box-cqrs"/>
  <text x="640" y="205" text-anchor="middle" class="text text-title">Handlers</text>
  <text x="640" y="225" text-anchor="middle" class="text text-small">QueryHandler</text>
  <text x="640" y="240" text-anchor="middle" class="text text-small">CommandHandler</text>

  <!-- Use Cases -->
  <rect x="550" y="290" width="180" height="60" class="box box-domain"/>
  <text x="640" y="315" text-anchor="middle" class="text text-title">Use Cases</text>
  <text x="640" y="335" text-anchor="middle" class="text text-small">Business Logic</text>

  <!-- Repository -->
  <rect x="550" y="390" width="180" height="60" class="box box-domain"/>
  <text x="640" y="415" text-anchor="middle" class="text text-title">Repository</text>
  <text x="640" y="435" text-anchor="middle" class="text text-small">Data Access</text>

  <!-- EventBus -->
  <rect x="280" y="200" width="200" height="70" class="box box-event"/>
  <text x="380" y="225" text-anchor="middle" class="text text-title">EventBus</text>
  <text x="380" y="245" text-anchor="middle" class="text text-small">publish() / subscribe()</text>
  <text x="380" y="260" text-anchor="middle" class="text text-small">Domain Events</text>

  <!-- Other ViewModels -->
  <rect x="50" y="200" width="150" height="70" class="box box-vm"/>
  <text x="125" y="225" text-anchor="middle" class="text text-title">Other VMs</text>
  <text x="125" y="245" text-anchor="middle" class="text text-small">Dashboard, Materials</text>
  <text x="125" y="260" text-anchor="middle" class="text text-small">Assessment, etc.</text>

  <!-- Events Box -->
  <rect x="50" y="320" width="150" height="120" class="box box-event"/>
  <text x="125" y="345" text-anchor="middle" class="text text-title">Domain Events</text>
  <text x="125" y="365" text-anchor="middle" class="text text-small">LoginSuccessEvent</text>
  <text x="125" y="380" text-anchor="middle" class="text text-small">MaterialUploadedEvent</text>
  <text x="125" y="395" text-anchor="middle" class="text text-small">AssessmentSubmittedEvent</text>
  <text x="125" y="410" text-anchor="middle" class="text text-small">ContextSwitchedEvent</text>
  <text x="125" y="425" text-anchor="middle" class="text text-small">...</text>

  <!-- Arrows: View -> ViewModel -->
  <path d="M200 100 L270 100" class="arrow"/>
  <text x="235" y="90" text-anchor="middle" class="text text-small">user action</text>

  <!-- Arrows: ViewModel -> Mediator -->
  <path d="M480 100 L540 100" class="arrow"/>
  <text x="510" y="90" text-anchor="middle" class="text text-small">query/cmd</text>

  <!-- Arrows: Mediator -> Handlers -->
  <path d="M640 140 L640 170" class="arrow"/>

  <!-- Arrows: Handlers -> Use Cases -->
  <path d="M640 250 L640 280" class="arrow"/>

  <!-- Arrows: Use Cases -> Repository -->
  <path d="M640 350 L640 380" class="arrow"/>

  <!-- Arrows: ViewModel -> EventBus (subscribe) -->
  <path d="M380 160 L380 190" class="arrow arrow-event" marker-end="url(#arrowhead-purple)"/>
  <text x="400" y="180" class="text text-small">subscribe</text>

  <!-- Arrows: EventBus -> Other VMs -->
  <path d="M280 235 L210 235" class="arrow arrow-event" marker-end="url(#arrowhead-purple)"/>
  <text x="245" y="225" class="text text-small">notify</text>

  <!-- Arrows: Handlers -> EventBus (publish) -->
  <path d="M550 215 L490 215" class="arrow arrow-event" marker-end="url(#arrowhead-purple)"/>
  <text x="520" y="205" class="text text-small">publish</text>

  <!-- Arrows: Events list -> EventBus -->
  <path d="M125 320 L125 280 L270 250" class="arrow arrow-event" marker-end="url(#arrowhead-purple)"/>

  <!-- Legend -->
  <rect x="280" y="380" width="200" height="100" class="box" fill="white"/>
  <text x="380" y="400" text-anchor="middle" class="text text-title">Legend</text>
  <line x1="290" y1="420" x2="330" y2="420" class="arrow"/>
  <text x="340" y="424" class="text text-small">Data flow</text>
  <line x1="290" y1="445" x2="330" y2="445" class="arrow arrow-event" marker-end="url(#arrowhead-purple)"/>
  <text x="340" y="449" class="text text-small">Event flow</text>
  <rect x="290" y="460" width="20" height="12" class="box box-vm"/>
  <text x="320" y="470" class="text text-small">ViewModel</text>
  <rect x="380" y="460" width="20" height="12" class="box box-cqrs"/>
  <text x="410" y="470" class="text text-small">CQRS</text>
</svg>
